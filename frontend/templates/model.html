<!DOCTYPE html>
<html class="dark" lang="en">
<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>Model - Cosmic Explorer</title>

  <!-- Fonts + Tailwind -->
  <link href="https://fonts.googleapis.com" rel="preconnect" />
  <link crossorigin href="https://fonts.gstatic.com" rel="preconnect" />
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: "#7c3aed",
            "background-dark": "#0e0f1a"
          },
          fontFamily: { display: ["Space Grotesk"] }
        }
      }
    }
  </script>

  <style>
    body { font-family: "Space Grotesk", system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial }

    /* --- Métricas (barras) --- */
    .metric-bar { height: 8px; width: 100%; background: rgba(255,255,255,.08); border-radius: 9999px; overflow: hidden; }
    .metric-fill { height: 100%; width: 0%; background: linear-gradient(90deg, #22d3ee, #3b82f6); transition: width .6s ease; }

    /* --- Diagrama Federated --- */
    #fl-svg { overflow: visible }
    /* no usamos transform en los nodos para que NO se muevan */
    #fl-svg .server, #fl-svg .device { pointer-events: none; }
    /* evita que el grosor del trazo cambie (y parezca que se desplaza) */
    #fl-svg rect, #fl-svg path { vector-effect: non-scaling-stroke; }

    #fl-svg .server rect, #fl-svg .device rect { fill: none; stroke: currentColor; stroke-width: 3 }
    #fl-svg .server .icon, #fl-svg .device .icon { fill: currentColor; opacity: .9 }

    .link { fill: none; stroke: #64748b; stroke-width: 3; stroke-linecap: round; opacity: .6 }
    .link.active { stroke: url(#flow-grad); opacity: 1; filter: drop-shadow(0 0 6px #22d3ee) }
    .link.flow { animation: dash 1.1s ease-out forwards }
    @keyframes dash { from { stroke-dashoffset: var(--len); } to { stroke-dashoffset: 0; } }

    /* “Parpadeo” estable (sin scale): sólo glow/opacity */
    .flash { animation: flash .8s ease-in-out 2 }
    @keyframes flash {
      0%   { filter: drop-shadow(0 0 0px #22d3ee); opacity: 1 }
      50%  { filter: drop-shadow(0 0 10px #22d3ee); opacity: 1 }
      100% { filter: drop-shadow(0 0 0px #22d3ee); opacity: 1 }
    }
  </style>
</head>

<body class="bg-background-dark text-white font-display min-h-screen flex flex-col">

  <!-- Header -->
  <header class="border-b border-white/10">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-6 flex items-center justify-between">
      <h1 class="text-xl font-bold tracking-tight">Cosmic Explorer — Model</h1>
      <span class="text-sm opacity-70">TESS · TOI · Federated Learning</span>
    </div>
  </header>

  <main class="flex-1">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-center">

        <!-- IZQUIERDA: diagrama federated -->
        <div class="text-center relative flex flex-col items-center justify-center">
          <button id="update-model-btn"
            class="mb-8 inline-flex items-center justify-center rounded-lg px-6 py-3 text-sm font-bold text-white bg-primary hover:bg-primary/90 transition-all hover:scale-105">
            Update Global Model
          </button>

          <!-- Diagrama: servidor + móviles -->
          <svg id="fl-svg" viewBox="0 0 520 360" class="w-[420px] h-[320px] text-gray-400">
            <defs>
              <linearGradient id="flow-grad" x1="0" y1="0" x2="1" y2="0">
                <stop offset="0%"  stop-color="#22d3ee"/>
                <stop offset="100%" stop-color="#3b82f6"/>
              </linearGradient>
            </defs>

            <!-- Servidor central -->
            <g class="server text-violet-500" transform="translate(210,20)">
              <rect x="0" y="0" width="100" height="140" rx="14" />
              <path class="icon"
                d="M35 95h30a6 6 0 0 0 6-6V51a6 6 0 0 0-6-6H35a6 6 0 0 0-6 6v38a6 6 0 0 0 6 6zm7-33h6v20h-6zm14 0h6v20h-6zm14 0h6v20h-6z"/>
            </g>

            <!-- Móviles -->
            <g class="device text-rose-500" transform="translate(30,230)">
              <rect x="0" y="0" width="80" height="120" rx="16"/>
              <circle cx="64" cy="14" r="5" class="icon"/>
              <rect x="12" y="30" width="56" height="72" rx="8"/>
              <path class="icon" d="M22 78l11-11 9 9 14-14 4 4-18 18-9-9-7 7z"/>
            </g>
            <g class="device text-sky-500" transform="translate(160,230)">
              <rect x="0" y="0" width="80" height="120" rx="16"/>
              <circle cx="64" cy="14" r="5" class="icon"/>
              <rect x="12" y="30" width="56" height="72" rx="8"/>
              <path class="icon" d="M22 78l11-11 9 9 14-14 4 4-18 18-9-9-7 7z"/>
            </g>
            <g class="device text-amber-500" transform="translate(290,230)">
              <rect x="0" y="0" width="80" height="120" rx="16"/>
              <circle cx="64" cy="14" r="5" class="icon"/>
              <rect x="12" y="30" width="56" height="72" rx="8"/>
              <path class="icon" d="M22 78l11-11 9 9 14-14 4 4-18 18-9-9-7 7z"/>
            </g>
            <g class="device text-emerald-500" transform="translate(420,230)">
              <rect x="0" y="0" width="80" height="120" rx="16"/>
              <circle cx="64" cy="14" r="5" class="icon"/>
              <rect x="12" y="30" width="56" height="72" rx="8"/>
              <path class="icon" d="M22 78l11-11 9 9 14-14 4 4-18 18-9-9-7 7z"/>
            </g>

            <!-- Enlaces (ahora dirigidos de móviles -> servidor) -->
            <path id="link1" class="link" d="M 70 235 C 100 210 150 195 210 160" />
            <path id="link2" class="link" d="M 200 235 C 210 215 230 200 250 160" />
            <path id="link3" class="link" d="M 370 235 C 350 215 330 200 310 160" />
            <path id="link4" class="link" d="M 485 235 C 460 210 410 195 350 160" />
          </svg>
        </div>

        <!-- DERECHA: métricas -->
        <div class="space-y-8">
          <div class="rounded-2xl border border-white/10 p-6 bg-white/5">
            <div class="flex items-baseline gap-3">
              <h2 class="text-lg font-semibold">Model Accuracy</h2>
              <span id="model-accuracy" class="text-3xl font-bold text-emerald-400">93.9%</span>
            </div>
            <p class="text-sm mt-2 opacity-70">Global model aggregated from federated clients.</p>
          </div>

          <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
            <div class="rounded-xl border border-white/10 p-5 bg-white/5">
              <div class="flex items-center justify-between mb-2">
                <span class="font-semibold">Precision</span>
                <span id="metric-precision" class="font-bold">89.0%</span>
              </div>
              <div class="metric-bar"><div id="bar-precision" class="metric-fill" style="width:89%"></div></div>
            </div>

            <div class="rounded-xl border border-white/10 p-5 bg-white/5">
              <div class="flex items-center justify-between mb-2">
                <span class="font-semibold">Recall</span>
                <span id="metric-recall" class="font-bold">87.2%</span>
              </div>
              <div class="metric-bar"><div id="bar-recall" class="metric-fill" style="width:87.2%"></div></div>
            </div>

            <div class="rounded-xl border border-white/10 p-5 bg-white/5">
              <div class="flex items-center justify-between mb-2">
                <span class="font-semibold">F1</span>
                <span id="metric-f1" class="font-bold">88.0%</span>
              </div>
              <div class="metric-bar"><div id="bar-f1" class="metric-fill" style="width:88%"></div></div>
            </div>
          </div>

          <div class="rounded-xl border border-white/10 p-6 bg-white/5">
            <h3 class="font-semibold mb-2">Notes</h3>
            <p class="text-sm opacity-80">
              Demo visual: el botón simula una ronda de federated learning, ilumina los enlaces (de clientes a
              servidor) y mejora ligeramente las métricas.
            </p>
          </div>
        </div>

      </div>
    </div>
  </main>

  <!-- JS: animación y actualización de métricas -->
  <script>
    document.getElementById('update-model-btn').addEventListener('click', function () {
      const svg = document.getElementById('fl-svg');
      const links = svg.querySelectorAll('.link');
      const nodes = svg.querySelectorAll('.server, .device');

      const accuracyText = document.getElementById('model-accuracy');
      const precisionText = document.getElementById('metric-precision');
      const recallText = document.getElementById('metric-recall');
      const f1Text = document.getElementById('metric-f1');
      const precisionBar = document.getElementById('bar-precision');
      const recallBar = document.getElementById('bar-recall');
      const f1Bar = document.getElementById('bar-f1');

      // 1) Anima enlaces móviles -> servidor
      links.forEach(p => {
        const len = p.getTotalLength();
        p.style.strokeDasharray = len;
        p.style.strokeDashoffset = len;     // dibuja desde el inicio (móvil) hacia el final (servidor)
        p.style.setProperty('--len', len);
        p.classList.remove('flow');
        p.classList.add('active');
        void p.getBoundingClientRect();     // reflow para reiniciar animación
        p.classList.add('flow');
        setTimeout(() => { p.classList.remove('active'); }, 1300);
      });

      // 2) Parpadeo estable en nodos (sin scale -> no se mueven)
      nodes.forEach(n => n.classList.add('flash'));
      setTimeout(() => nodes.forEach(n => n.classList.remove('flash')), 1500);

      // 3) Actualiza métricas
      setTimeout(() => {
        const oldA = parseFloat(accuracyText.textContent);
        const newA = Math.min(oldA + (Math.random()*0.2)+0.1, 99.9);
        accuracyText.textContent = newA.toFixed(1) + '%';

        const oldP = parseFloat(precisionText.textContent);
        const newP = Math.min(oldP + (Math.random()*0.3), 99.9);
        precisionText.textContent = newP.toFixed(1) + '%';
        precisionBar.style.width = newP.toFixed(1) + '%';

        const oldR = parseFloat(recallText.textContent);
        const newR = Math.min(oldR + (Math.random()*0.2), 99.9);
        recallText.textContent = newR.toFixed(1) + '%';
        recallBar.style.width = newR.toFixed(1) + '%';

        const oldF = parseFloat(f1Text.textContent);
        const newF = Math.min(oldF + (Math.random()*0.25), 99.9);
        f1Text.textContent = newF.toFixed(1) + '%';
        f1Bar.style.width = newF.toFixed(1) + '%';
      }, 400);
    });
  </script>
</body>
</html>
